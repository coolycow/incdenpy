# Что это
Программа для генерации искусственных отражений в LAS-файлах.  
Используется для увеличения плотности ТЛО, в случаях когда имеющейся плотности недостаточно.  
Для работы используется [laspy](https://laspy.readthedocs.io/en/latest/).  
Может работать в режиме нескольких процессов (`multiprocessing`) для одновременной обработки нескольких файлов.

# Обработка в нескольких процессах
По умолчанию в `config.yaml` значение `max_workers` установлено равным 4 и включен режим `workers:true`.  
С таким значением одновременно будет обрабатываться 4 файла и в каждом файле каждые 4 включения также будут обрабатываться отдельными процессами.  
Таким образом достигается максимально возможная в данном случае производительность.

**Не рекомендуется** ставить количество потоков, превышающее количество **физических** ядер процессора.

# Настройки
Все нужные настройки установлены в файле `config.yaml`.  
Наличие данного файла является **обязательным**.  
При необходимости все настройки можно переопределить в параметрах запуска (см. Пример запуска).  
Значения, которые установлены в `config.yaml`, взяты из исходной программы IncDen.

# Параметры
1. **max_distance** – максимальное 3D-расстояние в `МЕТРАХ` между двумя соседними точками, между которыми возможна генерация новых точек;
2. **max_angle** – максимальный угол в `ГРАДУСАХ` между двумя соседними точками, между которыми возможна генерация новых точек;
3. **angle_distance** – расстояние в `МЕТРАХ` в пределах которого угол между двумя соседними точками может игнорироваться;
4. **quantity** – сколько точек необходимо сгенерировать между двумя соседними точками;
5. **point_class** – класс для новых точек. Имеет диапазон значений `от 0 до 256`, при значении равным -1 класс точки задается на основании исходных точек, между которыми происходит генерация;
6. **time_diff** – максимальная разница в `СЕКУНДАХ` между двумя соседними точками, между которыми возможна генерация новых точек;
7. **ignore_classes** – список классов через `ПРОБЕЛ`, для которых не возможна генерация. Причем если в паре точек хотя бы одна имеет класс из данного списка, то генерация не происходит.
8. **test_mode** – тестовый режим работы программы. В этом режиме точки, которые сработали стопорами для генерации изменяются:
   1. Если сработал стопор по расстоянию – обе точки получают класс `110`; 
   2. Если сработал стопор по углу, то обе точки получают класс `111` и в качестве Line задается угол между точками;
9. **no_test_mode** - отключить тестовый режим;
10. **workers** - использовать потоки;
11. **no_workers** - не использовать потоки;
12. **max_workers** - максимальное количество потоков;
13. **final_sort** - сортировать финальные точки по времени;
14. **no_final_sort** - не сортировать финальные точки по времени;
15. **input_folder** - папка с исходными файлами;
16. **output_folder** - папка для результирующих файлов;
17. **files** - список файлов для обработки через `ПРОБЕЛ`, если указан, то `input_folder` игнорируется. Результирующие файлы будут записаны в `output_folder`.

# Пример запуска
Если используются ТОЛЬКО настройки из `config.yaml`:
```commandline
python incden.py
```

Если используются настройки из `my_config.yam` и дополнительно указываются параметры запуска:
```commandline
python incden.py --config my_config.yaml --max_distance 2.1 --ignore_classes 2 5 8 --max_workers=8 --workers --no_test_mode --final_sort
```

Если нужно обработать только выбранные файлы:
```commandline
python incden.py --files i:\prj\UTM42_WGS84_0008.las i:\prj\UTM42_WGS84_0009.las i:\prj\UTM42_WGS84_0010.las
```
